{
  "$schema" : "https://json-schema.axonivy.com/process/12.0.0/process.json",
  "id" : "187997E4FAE2FBE9",
  "kind" : "CALLABLE_SUB",
  "config" : {
    "data" : "com.openai.connector.openaiData"
  },
  "elements" : [ {
      "id" : "f0",
      "type" : "CallSubStart",
      "name" : "chatGpt(String)",
      "config" : {
        "signature" : "chatGpt",
        "input" : {
          "params" : [
            { "name" : "what", "type" : "String", "desc" : "" }
          ],
          "map" : { },
          "code" : [
            "import com.openai.api.v1.client.ChatCompletionRequestUserMessage;",
            "out.logitBias = new java.util.HashMap();",
            "out.logitBias.put(\"50256\", -100);",
            "",
            "ChatCompletionRequestUserMessage message = new ChatCompletionRequestUserMessage();",
            "message.content = param.what;",
            "message.name = ivy.session.getSessionUserName();",
            "message.role = com.openai.api.v1.client.ChatCompletionRequestUserMessage.RoleEnum.USER;",
            "out.message = message;"
          ]
        },
        "result" : {
          "params" : [
            { "name" : "answer", "type" : "String", "desc" : "" }
          ],
          "map" : {
            "result.answer" : "in.answer"
          }
        }
      },
      "tags" : [
        "connector"
      ],
      "visual" : {
        "at" : { "x" : 96, "y" : 64 },
        "icon" : "res:/webContent/logo/OpenAI_Logo.png?small"
      },
      "connect" : [
        { "id" : "f4", "to" : "f3" }
      ]
    }, {
      "id" : "f1",
      "type" : "CallSubEnd",
      "visual" : {
        "at" : { "x" : 352, "y" : 64 }
      }
    }, {
      "id" : "f3",
      "type" : "RestClientCall",
      "name" : "openai (OpenAI API)",
      "config" : {
        "method" : "POST",
        "target" : {
          "clientId" : "6840e778-eb27-42a0-afdc-87588ffae871",
          "path" : "/chat/completions"
        },
        "body" : {
          "entity" : {
            "type" : "com.openai.api.v1.client.CreateChatCompletionRequest",
            "map" : {
              "param.audio.format" : "com.openai.api.v1.client.CreateChatCompletionRequestAudio.FormatEnum.MP3",
              "param.audio.voice" : "com.openai.api.v1.client.CreateChatCompletionRequestAudio.VoiceEnum.ECHO",
              "param.logitBias" : "in.logitBias",
              "param.messages" : "[in.message]",
              "param.model" : "com.openai.api.v1.client.CreateChatCompletionRequest.ModelEnum.GPT_3_5_TURBO",
              "param.user" : "ivy.session.getSessionUserName()"
            }
          }
        },
        "response" : {
          "entity" : {
            "type" : "com.openai.api.v1.client.CreateChatCompletionResponse",
            "map" : {
              "out.answer" : "result.choices.get(0).message.content"
            }
          }
        }
      },
      "visual" : {
        "at" : { "x" : 224, "y" : 64 },
        "icon" : "res:/webContent/logo/OpenAI_Logo.png"
      },
      "connect" : [
        { "id" : "f2", "to" : "f1" }
      ]
    }, {
      "id" : "f5",
      "type" : "RequestStart",
      "name" : "start",
      "config" : {
        "signature" : "start"
      },
      "visual" : {
        "at" : { "x" : 248, "y" : 312 }
      },
      "connect" : [
        { "id" : "f7", "to" : "f6" }
      ]
    }, {
      "id" : "f6",
      "type" : "RestClientCall",
      "config" : {
        "target" : {
          "clientId" : "6840e778-eb27-42a0-afdc-87588ffae871",
          "path" : "/assistants",
          "templateParams" : {
            "assistant_id" : "\"asst_0INo6Gmcf1A4z2qDBL0Ppkpj\""
          },
          "queryParams" : {
            "limit" : "",
            "order" : "",
            "after" : "",
            "before" : ""
          },
          "headers" : {
            "OpenAI-Beta" : "\"assistants=v2\""
          }
        },
        "response" : {
          "entity" : {
            "type" : "com.openai.api.v1.client.ListAssistantsResponse",
            "code" : "ivy.log.info(result);"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 392, "y" : 312 }
      },
      "connect" : [
        { "id" : "f9", "to" : "f8" }
      ]
    }, {
      "id" : "f8",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 520, "y" : 312 },
        "labelOffset" : { "x" : 13, "y" : 33 }
      }
    }, {
      "id" : "f10",
      "type" : "RequestStart",
      "name" : "start2",
      "config" : {
        "signature" : "start2"
      },
      "visual" : {
        "at" : { "x" : 248, "y" : 464 }
      },
      "connect" : [
        { "id" : "f12", "to" : "f11" }
      ]
    }, {
      "id" : "f11",
      "type" : "Script",
      "config" : {
        "output" : {
          "code" : [
            "import com.axonivy.connector.openai.JsonService;",
            "JsonService j = new JsonService();",
            "j.de();"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 440, "y" : 464 }
      },
      "connect" : [
        { "id" : "f14", "to" : "f13" }
      ]
    }, {
      "id" : "f13",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 632, "y" : 464 },
        "labelOffset" : { "x" : 13, "y" : 33 }
      }
    }, {
      "id" : "f15",
      "type" : "RequestStart",
      "name" : "start3",
      "config" : {
        "signature" : "start3"
      },
      "visual" : {
        "at" : { "x" : 376, "y" : 704 }
      },
      "connect" : [
        { "id" : "f19", "to" : "f17" }
      ]
    }, {
      "id" : "f16",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 648, "y" : 704 },
        "labelOffset" : { "x" : 13, "y" : 33 }
      }
    }, {
      "id" : "f17",
      "type" : "RestClientCall",
      "config" : {
        "target" : {
          "clientId" : "6840e778-eb27-42a0-afdc-87588ffae871",
          "path" : "/fine_tuning/jobs",
          "templateParams" : {
            "assistant_id" : "\"asst_0INo6Gmcf1A4z2qDBL0Ppkpj\""
          },
          "queryParams" : {
            "limit" : "",
            "order" : "",
            "after" : "",
            "before" : ""
          },
          "headers" : {
            "OpenAI-Beta" : "\"assistants=v2\""
          }
        },
        "response" : {
          "entity" : {
            "type" : "com.openai.api.v1.client.ListPaginatedFineTuningJobsResponse",
            "code" : "ivy.log.info(result);"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 520, "y" : 704 }
      },
      "connect" : [
        { "id" : "f18", "to" : "f16" }
      ]
    } ]
}